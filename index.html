<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grade 6 Numeracy Flashcards (English–Farsi)</title>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --accent:#22d3ee; --accent-2:#f59e0b; --muted:#e5e7eb; --text:#f8fafc;
    --good:#10b981; --bad:#ef4444; --card:#0b1220; --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 80% -10%, #1e293b 0%, var(--bg) 40%);
    color:var(--text); display:flex; flex-direction:column; gap:16px; padding:16px; }
  header{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  header h1{font-size:1.1rem; margin:0; letter-spacing:.2px; font-weight:700}
  .controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; background:linear-gradient(180deg,#0c1222,var(--panel));
    padding:10px; border-radius:10px; box-shadow:var(--shadow); border:1px solid #1f2937; }
  .controls > * { margin:0 }
  select, button, input[type="checkbox"]{ font:inherit; color:var(--text); background:#0b1220; border:1px solid #263042; padding:8px 10px; border-radius:8px; }
  button{ cursor:pointer; transition:transform .04s ease, background .2s ease; }
  button:hover{ transform:translateY(-1px); }
  button.primary{ background:linear-gradient(180deg,#0aa3b8,#0284c7); border-color:#0369a1 }
  button.good{ background:linear-gradient(180deg,#10b981,#059669); border-color:#047857 }
  button.bad{ background:linear-gradient(180deg,#ef4444,#b91c1c); border-color:#7f1d1d }
  .pill{ padding:6px 10px; border-radius:999px; border:1px solid #263042; background:#0b1220; font-size:.9rem; }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .grow{ flex:1 1 auto; }
  .right{ margin-left:auto }
  .progress{ width:100%; height:10px; background:#111827; border:1px solid #263042; border-radius:999px; overflow:hidden; box-shadow: inset 0 2px 8px rgba(0,0,0,.3); }
  .progress > div{ height:100%; background: linear-gradient(90deg, var(--accent), #60a5fa); width:0%; }
  .stage{ display:grid; place-items:center; flex:1; min-height:50vh; }
  .card{ width:min(800px, 92vw); aspect-ratio:16/9; background: radial-gradient(900px 600px at 20% -10%, #111b33, var(--card));
    border:1px solid #253046; border-radius:18px; box-shadow: var(--shadow);
    display:flex; align-items:center; justify-content:center; padding:24px; perspective:1200px; position:relative; user-select:none; }
  .inner{ position:relative; width:100%; height:100%; transform-style:preserve-3d; transition: transform .5s ease; }
  .card.flipped .inner{ transform: rotateY(180deg); }
  .face{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:24px; backface-visibility:hidden; }
  .term{ font-size: clamp(1.6rem, 5vw, 3rem); text-align:center; line-height:1.2; letter-spacing:.3px; }
  .sub{ position:absolute; bottom:14px; left:16px; right:16px; display:flex; justify-content:space-between; font-size:.95rem; color:#cbd5e1; opacity:.9; }
  .cat{ color: var(--accent-2) }
  .face.back{ transform: rotateY(180deg); }
  .rtl{ direction: rtl; font-family: "Noto Naskh Arabic","Noto Sans Arabic","Vazirmatn",Tahoma,Arial,sans-serif; }
  footer{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; opacity:.9 }
  .kbd{ font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; background:#0b1220; border:1px solid #263042; padding:2px 6px; border-radius:6px; }
  @media (max-width:600px){ .sub{ font-size:.85rem } }
</style>
</head>
<body>
  <header>
    <h1>Grade 6 Numeracy Flashcards — English ↔ Farsi</h1>
    <div class="row right">
      <span class="pill">Space: Flip</span>
      <span class="pill">←/→: Prev/Next</span>
      <span class="pill">S: Shuffle</span>
      <span class="pill">G/P: Got it / Practice</span>
    </div>
  </header>

  <div class="controls">
    <div class="row grow">
      <label>Category:
        <select id="category">
          <option value="all">All (100)</option>
          <option value="Numbers and Operations">Numbers & Operations</option>
          <option value="Arithmetic and Equations">Arithmetic & Equations</option>
          <option value="Measurement and Geometry">Measurement & Geometry</option>
          <option value="Data and Probability">Data & Probability</option>
          <option value="Patterns, Algebra, and Reasoning">Patterns, Algebra & Reasoning</option>
        </select>
      </label>
      <label class="row">
        Front side:
        <select id="front">
          <option value="en">English</option>
          <option value="fa">Farsi</option>
        </select>
      </label>
      <label class="row">
        Deck:
        <select id="deck">
          <option value="all">All cards</option>
          <option value="practice">Practice only</option>
          <option value="gotit">Got it only</option>
        </select>
      </label>
      <label class="row">
        <input type="checkbox" id="tts" />
        <span>Speak card (TTS)</span>
      </label>
      <div class="right row">
        <button id="shuffle" title="Shuffle (S)">Shuffle</button>
        <button id="resetProgress" title="Clear statuses">Reset Progress</button>
      </div>
    </div>
  </div>

  <div class="progress"><div id="bar"></div></div>

  <div class="stage">
    <div id="card" class="card" tabindex="0" aria-live="polite">
      <div class="inner">
        <div class="face front">
          <div class="term" id="frontTerm">Loading…</div>
          <div class="sub"><span id="counter">0 / 0</span><span class="cat" id="cat"></span></div>
        </div>
        <div class="face back">
          <div class="term" id="backTerm">…</div>
          <div class="sub"><span>Press <span class="kbd">G</span> if you “Got it”, <span class="kbd">P</span> for “Practice”</span><span id="cat2" class="cat"></span></div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="row">
      <button id="prev">← Prev</button>
      <button id="flip" class="primary">Flip (Space)</button>
      <button id="next">Next →</button>
    </div>
    <div class="row">
      <button id="got" class="good">Got it (G)</button>
      <button id="practice" class="bad">Practice (P)</button>
    </div>
  </footer>

<script>
/* ---------- Data: 100 cards ---------- */
const CARDS = [
  {en:"Number", fa:"عدد", cat:"Numbers and Operations"},
  {en:"Digit", fa:"رقم", cat:"Numbers and Operations"},
  {en:"Integer", fa:"عدد صحیح", cat:"Numbers and Operations"},
  {en:"Fraction", fa:"کسر", cat:"Numbers and Operations"},
  {en:"Decimal", fa:"عدد اعشاری", cat:"Numbers and Operations"},
  {en:"Percent", fa:"درصد", cat:"Numbers and Operations"},
  {en:"Ratio", fa:"نسبت", cat:"Numbers and Operations"},
  {en:"Proportion", fa:"تناسب", cat:"Numbers and Operations"},
  {en:"Multiple", fa:"مضرب", cat:"Numbers and Operations"},
  {en:"Factor", fa:"عامل", cat:"Numbers and Operations"},
  {en:"Prime", fa:"عدد اول", cat:"Numbers and Operations"},
  {en:"Composite", fa:"عدد مرکب", cat:"Numbers and Operations"},
  {en:"Even", fa:"زوج", cat:"Numbers and Operations"},
  {en:"Odd", fa:"فرد", cat:"Numbers and Operations"},
  {en:"Sum", fa:"مجموع", cat:"Numbers and Operations"},
  {en:"Difference", fa:"تفاضل", cat:"Numbers and Operations"},
  {en:"Product", fa:"حاصل‌ضرب", cat:"Numbers and Operations"},
  {en:"Quotient", fa:"خارج‌قسمت", cat:"Numbers and Operations"},
  {en:"Remainder", fa:"باقیمانده", cat:"Numbers and Operations"},
  {en:"Operation", fa:"عمل", cat:"Numbers and Operations"},
  {en:"Addition", fa:"جمع", cat:"Arithmetic and Equations"},
  {en:"Subtraction", fa:"تفریق", cat:"Arithmetic and Equations"},
  {en:"Multiplication", fa:"ضرب", cat:"Arithmetic and Equations"},
  {en:"Division", fa:"تقسیم", cat:"Arithmetic and Equations"},
  {en:"Equation", fa:"معادله", cat:"Arithmetic and Equations"},
  {en:"Expression", fa:"عبارت", cat:"Arithmetic and Equations"},
  {en:"Variable", fa:"متغیر", cat:"Arithmetic and Equations"},
  {en:"Constant", fa:"ثابت", cat:"Arithmetic and Equations"},
  {en:"Simplify", fa:"ساده کردن", cat:"Arithmetic and Equations"},
  {en:"Solve", fa:"حل کردن", cat:"Arithmetic and Equations"},
  {en:"Substitute", fa:"جایگزین کردن", cat:"Arithmetic and Equations"},
  {en:"Balance", fa:"تراز کردن", cat:"Arithmetic and Equations"},
  {en:"Term", fa:"جمله", cat:"Arithmetic and Equations"},
  {en:"Coefficient", fa:"ضریب", cat:"Arithmetic and Equations"},
  {en:"Inequality", fa:"نامساوی", cat:"Arithmetic and Equations"},
  {en:"Inverse", fa:"معکوس", cat:"Arithmetic and Equations"},
  {en:"Estimate", fa:"تخمین زدن", cat:"Arithmetic and Equations"},
  {en:"Round", fa:"گرد کردن", cat:"Arithmetic and Equations"},
  {en:"Approximation", fa:"تقریب", cat:"Arithmetic and Equations"},
  {en:"Evaluate", fa:"ارزیابی کردن", cat:"Arithmetic and Equations"},
  {en:"Length", fa:"طول", cat:"Measurement and Geometry"},
  {en:"Width", fa:"عرض", cat:"Measurement and Geometry"},
  {en:"Height", fa:"ارتفاع", cat:"Measurement and Geometry"},
  {en:"Perimeter", fa:"محیط", cat:"Measurement and Geometry"},
  {en:"Area", fa:"مساحت", cat:"Measurement and Geometry"},
  {en:"Volume", fa:"حجم", cat:"Measurement and Geometry"},
  {en:"Capacity", fa:"گنجایش", cat:"Measurement and Geometry"},
  {en:"Angle", fa:"زاویه", cat:"Measurement and Geometry"},
  {en:"Vertex", fa:"رأس", cat:"Measurement and Geometry"},
  {en:"Edge", fa:"یال", cat:"Measurement and Geometry"},
  {en:"Face", fa:"وجه", cat:"Measurement and Geometry"},
  {en:"Polygon", fa:"چندضلعی", cat:"Measurement and Geometry"},
  {en:"Triangle", fa:"مثلث", cat:"Measurement and Geometry"},
  {en:"Rectangle", fa:"مستطیل", cat:"Measurement and Geometry"},
  {en:"Square", fa:"مربع", cat:"Measurement and Geometry"},
  {en:"Circle", fa:"دایره", cat:"Measurement and Geometry"},
  {en:"Radius", fa:"شعاع", cat:"Measurement and Geometry"},
  {en:"Diameter", fa:"قطر", cat:"Measurement and Geometry"},
  {en:"Circumference", fa:"محیط دایره", cat:"Measurement and Geometry"},
  {en:"Parallel", fa:"موازی", cat:"Measurement and Geometry"},
  {en:"Data", fa:"داده", cat:"Data and Probability"},
  {en:"Graph", fa:"نمودار", cat:"Data and Probability"},
  {en:"Table", fa:"جدول", cat:"Data and Probability"},
  {en:"Chart", fa:"چارت", cat:"Data and Probability"},
  {en:"Axis", fa:"محور", cat:"Data and Probability"},
  {en:"Coordinate", fa:"مختصات", cat:"Data and Probability"},
  {en:"Mean", fa:"میانگین", cat:"Data and Probability"},
  {en:"Median", fa:"میانه", cat:"Data and Probability"},
  {en:"Mode", fa:"نما", cat:"Data and Probability"},
  {en:"Range", fa:"دامنه", cat:"Data and Probability"},
  {en:"Probability", fa:"احتمال", cat:"Data and Probability"},
  {en:"Chance", fa:"شانس", cat:"Data and Probability"},
  {en:"Outcome", fa:"نتیجه", cat:"Data and Probability"},
  {en:"Experiment", fa:"آزمایش", cat:"Data and Probability"},
  {en:"Event", fa:"رویداد", cat:"Data and Probability"},
  {en:"Sample", fa:"نمونه", cat:"Data and Probability"},
  {en:"Population", fa:"جامعه آماری", cat:"Data and Probability"},
  {en:"Frequency", fa:"فراوانی", cat:"Data and Probability"},
  {en:"Histogram", fa:"هیستوگرام", cat:"Data and Probability"},
  {en:"Bar graph", fa:"نمودار میله‌ای", cat:"Data and Probability"},
  {en:"Pattern", fa:"الگو", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Sequence", fa:"دنباله", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Rule", fa:"قانون", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Function", fa:"تابع", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Input", fa:"ورودی", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Output", fa:"خروجی", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Table of values", fa:"جدول مقادیر", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Coordinate plane", fa:"صفحه مختصات", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Ordered pair", fa:"جفت مرتب", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Relation", fa:"رابطه", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Formula", fa:"فرمول", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Equation", fa:"معادله", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Balance", fa:"توازن", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Variable", fa:"متغیر", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Simplify", fa:"ساده‌سازی", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Substitute", fa:"جایگزینی", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Analyze", fa:"تحلیل کردن", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Predict", fa:"پیش‌بینی کردن", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Model", fa:"مدل", cat:"Patterns, Algebra, and Reasoning"},
  {en:"Reasoning", fa:"استدلال", cat:"Patterns, Algebra, and Reasoning"}
];

const els = {
  category: document.getElementById('category'),
  front: document.getElementById('front'),
  deck: document.getElementById('deck'),
  tts: document.getElementById('tts'),
  shuffle: document.getElementById('shuffle'),
  resetProgress: document.getElementById('resetProgress'),
  card: document.getElementById('card'),
  inner: document.querySelector('.inner'),
  frontTerm: document.getElementById('frontTerm'),
  backTerm: document.getElementById('backTerm'),
  counter: document.getElementById('counter'),
  cat: document.getElementById('cat'),
  cat2: document.getElementById('cat2'),
  flipBtn: document.getElementById('flip'),
  next: document.getElementById('next'),
  prev: document.getElementById('prev'),
  got: document.getElementById('got'),
  practice: document.getElementById('practice'),
  bar: document.getElementById('bar'),
};

const STORAGE_KEY = 'numeracy_flash_status_v1';
const statusMap = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

let current = 0;
let flipped = false;
let view = [];
let voices = [];

/* --- TTS --- */
if ('speechSynthesis' in window) {
  function loadVoices(){ voices = window.speechSynthesis.getVoices(); }
  loadVoices();
  if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;
}
function speak(text, lang='en'){
  if (!els.tts.checked || !('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  const targetLang = lang === 'fa' ? 'fa-IR' : 'en-US';
  const v = voices.find(v => v.lang === targetLang) || voices.find(v => v.lang.startsWith(lang)) || null;
  if (v) u.voice = v;
  u.lang = targetLang;
  u.rate = 0.95;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ---------- Deck ---------- */
function buildView(){
  const catVal = els.category.value;
  const deckVal = els.deck.value;
  let idxs = CARDS.map((_,i)=>i);
  if (catVal !== 'all'){ idxs = idxs.filter(i => CARDS[i].cat === catVal); }
  if (deckVal !== 'all'){
    idxs = idxs.filter(i => {
      const st = statusMap[CARDS[i].en];
      return deckVal === 'practice' ? st === 'practice' : st === 'gotit';
    });
  }
  if (idxs.length === 0) idxs = [0];
  view = idxs;
  current = 0;
  flipped = false;
  render();
}

function shuffleView(){
  for (let i = view.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i+1));
    [view[i], view[j]] = [view[j], view[i]];
  }
  current = 0;
  flipped = false;
  render();
}

/* ---------- Render: front face = selected language; back face = opposite. ---------- */
function render(){
  const total = view.length;
  const c = CARDS[view[current]];
  const frontLang = els.front.value; // 'en' or 'fa'
  const backLang  = frontLang === 'en' ? 'fa' : 'en';

  // Set content ONCE, independent of flipped state
  els.frontTerm.textContent = c[frontLang];
  els.backTerm.textContent  = c[backLang];

  // RTL classes fixed to which side holds Farsi
  els.frontTerm.classList.toggle('rtl', frontLang === 'fa');
  els.backTerm.classList.toggle('rtl', backLang === 'fa');

  // Flip state only changes which face is visible
  els.card.classList.toggle('flipped', flipped);

  // Counters & category
  els.counter.textContent = `${current+1} / ${total}`;
  els.cat.textContent = c.cat;
  els.cat2.textContent = c.cat;

  // Progress in current view
  const gotCount = view.reduce((acc,i)=> acc + (statusMap[CARDS[i].en]==='gotit' ? 1 : 0), 0);
  els.bar.style.width = total ? `${Math.round((gotCount/total)*100)}%` : '0%';

  // Speak the currently visible side
  const visibleLang = flipped ? backLang : frontLang;
  const textToSpeak = flipped ? c[backLang] : c[frontLang];
  speak(textToSpeak, visibleLang);
}

function flip(){
  flipped = !flipped;
  render();
}
function move(delta){
  current += delta;
  if (current < 0) current = view.length - 1;
  if (current >= view.length) current = 0;
  flipped = false; // moving to a new card shows the front first
  render();
}
function mark(status){
  const card = CARDS[view[current]];
  if (status) statusMap[card.en] = status; else delete statusMap[card.en];
  localStorage.setItem(STORAGE_KEY, JSON.stringify(statusMap));
  move(+1);
}

/* ---------- Events ---------- */
els.flipBtn.addEventListener('click', flip);
els.card.addEventListener('click', flip);
els.next.addEventListener('click', ()=>move(+1));
els.prev.addEventListener('click', ()=>move(-1));
els.shuffle.addEventListener('click', ()=>{ shuffleView(); announce('Shuffled deck'); });
els.resetProgress.addEventListener('click', ()=>{
  if (confirm('Reset “Got it / Practice” for all cards?')){
    for (const k in statusMap) delete statusMap[k];
    localStorage.setItem(STORAGE_KEY, JSON.stringify(statusMap));
    render(); announce('Progress reset');
  }
});
els.got.addEventListener('click', ()=>mark('gotit'));
els.practice.addEventListener('click', ()=>mark('practice'));
els.category.addEventListener('change', buildView);
els.front.addEventListener('change', render);
els.deck.addEventListener('change', buildView);
els.tts.addEventListener('change', render);

document.addEventListener('keydown', (e)=>{
  if (e.target && ['INPUT','SELECT','TEXTAREA','BUTTON'].includes(e.target.tagName)) return;
  if (e.code === 'Space'){ e.preventDefault(); flip(); }
  else if (e.key === 'ArrowRight'){ move(+1); }
  else if (e.key === 'ArrowLeft'){ move(-1); }
  else if (e.key.toLowerCase() === 's'){ shuffleView(); }
  else if (e.key.toLowerCase() === 'g'){ mark('gotit'); }
  else if (e.key.toLowerCase() === 'p'){ mark('practice'); }
});

/* a11y live region */
const live = document.createElement('div');
live.setAttribute('aria-live','polite');
live.style.position='absolute'; live.style.left='-9999px';
document.body.appendChild(live);
function announce(msg){ live.textContent = msg; }

/* Init */
buildView();
shuffleView();
</script>
</body>
</html>
